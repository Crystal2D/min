class FontAtlas{#t=[];lineHeight=20;texture=null;constructor(t,e){this.texture=t;const s=this.texture.sprites.length;for(let t=0;t<e.length;t++){const r=new Sprite(this.texture,e[t].rect),h=s+t;this.texture.sprites.push(r),this.#t.push({character:e[t].character,index:h})}}GetGlyph(t){const e=this.#t.find((e=>e.character===t)).index;return this.texture.sprites[e]}}class FontGlyph{character="";rect=null;constructor(c,t){this.character=c??"",this.rect=t??new Rect}}class TextChar{#t=[];#r=Vector2.zero;#e=Vector2.zero;#s=new Color(1,1,1);trisCount=0;textureArray=[];localVertexArray=[];colorArray=[];parent=null;get vertexArray(){return this.#t}set vertexArray(t){this.#t=t,this.#o()}get position(){return this.#r}set position(t){this.#r=t,this.#o()}get offset(){return this.#e}set offset(t){this.#e=t,this.#o()}get color(){return this.#s}set color(t){this.#s=t;const r=[t.r,t.g,t.b,t.a];this.colorArray=[...r,...r,...r,...r,...r,...r],this.parent.RemapGraphicArrays()}#o(){const t=this.#r.x+this.#e.x,r=this.#r.y-this.#e.y;let e=[...this.#t];for(let s=0;s<this.trisCount;s++){const o=2*s;e[o]+=t,e[o+1]-=r}this.localVertexArray=e}}class Text extends DynamicRenderer{#t=!1;#e=!1;#i=!1;#s=!1;#h=0;#r=0;#o=0;#n=8.5;#a=1.5;#l=1;#c="";#u=[];#g=[];#d=[];#f=[];#p=Vector2.zero;#w=Vector2.zero;#x=Vector2.one;#m=null;#A=null;characters=[];pivot=new Vector2(.5,.5);get meshChanged(){return this.#t}get bounds(){const t=Vector2.Scale(this.transform.localScale,this.#p),e=this.pivot,i=this.#w;let s=this.transform.localPosition;switch(this.horizontalAlign){case 0:s.x+=i.x;break;case 2:s.x-=i.x}switch(this.verticalAlign){case 0:s.y+=i.y;break;case 2:s.y-=i.y}return new Bounds(Vector2.Add(s,Vector2.Scale(t,new Vector2(.5-e.x,e.y-.5))),t)}get fontSize(){return this.#l}set fontSize(t){this.#l=t,this.#y()}get font(){return this.#m}set font(t){this.#m=t,this.#z(),this.#y()}get width(){return this.#n}set width(t){this.#n=t,this.#t=!0}get height(){return this.#a}set height(t){this.#a=t,this.#t=!0}get overflowWidth(){return this.#i}set overflowWidth(t){this.#i=t,this.#t=!0}get overflowHeight(){return this.#s}set overflowHeight(t){this.#s=t,this.#t=!0}get horizontalAlign(){return this.#h}set horizontalAlign(t){this.#h=t,this.#e=!0}get verticalAlign(){return this.#r}set verticalAlign(t){this.#r=t,this.#e=!0}get text(){return this.#c}set text(t){this.#c!==t&&(this.#c=t,this.#z())}get pixelPerUnit(){return this.font.texture.pixelPerUnit}get localToWorldMatrix(){return Matrix3x3.Multiply(this.transform.localToWorldMatrix,Matrix3x3.TRS(Vector2.Scale(this.pivot,new Vector2(-this.#n,-this.#a)),0,this.#x))}#v=class{lineBreak=!1;space=!1;width=0;height=0;sprites=[];Add(t){this.sprites.push(t)}Update(){let t=0,e=0;for(let i=0;i<this.sprites.length;i++){const s=this.sprites[i].rect;t+=s.width,e<s.height&&(e=s.height)}this.width=t,this.height=e}};constructor(t,e){super(e),this.Reload(),this.font=t}#S(t,e){const i=t.vertices,s=i[0],h=t.triangles;let r=[],o=[];for(let t=0;t<h.length;t++){const e=i[h[t]],n=2*t;r[n]=e.x-s.x,r[n+1]=e.y-s.y,o[n]=e.x,o[n+1]=e.y}const n=new TextChar;return n.parent=this,n.trisCount=h.length,n.vertexArray=r,n.textureArray=o,n.position=e,n.color=this.#A.Duplicate(),n}#z(){const t=this.#c;let e=[new this.#v];for(let i=0;i<t.length;i++){const s="\n"===t[i];let h=null;s||(h=this.font.GetGlyph(t[i]))," "!==t[i]?s?(0!==i&&(e[e.length-1].Update(),e.push(new this.#v)),e[e.length-1].lineBreak=!0,e.push(new this.#v)):(e[e.length-1].space&&(e[e.length-1].Update(),e.push(new this.#v)),e[e.length-1].Add(h)):(0===i||e[e.length-1].space||(e[e.length-1].Update(),e.push(new this.#v)),e[e.length-1].Add(h),e[e.length-1].space=!0)}e[e.length-1].Update(),this.#u=e,this.#t=!0}#y(){const t=this.pixelPerUnit/this.#l,e=this.font.texture,i=e.width,s=e.height;this.#x=Vector2.Scale(i>s?new Vector2(1,s/i):new Vector2(i/s,1),i>s?i/t:s/t),this.#t=!0}#C(t,e){const i=this.#m.texture.width;let s=e.x,h=[];for(let r=0;r<t.length;r++){const o=t[r],n=o.rect.width/i,a=this.#S(o,new Vector2(s,-e.y));h.push(a),s+=n}return h}#V(){const t=this.pixelPerUnit/this.#l,e=this.#n/(this.#m.texture.width/t),i=this.#a/(this.#m.texture.height/t),s=this.#g,h=.5*(i-this.#o)*this.#r,r=this.characters;let o=0,n=0,a=s[0].count,l=.5*(e-s[0].size)*this.#h,c=[],u=[],g=[],d=[],f=[];for(let t=0;t<r.length;t++){if(0!==this.horizontalAlign){if(0===a){n++;const t=s[n];a=t.count,l=.5*(e-t.size)*this.#h}a--}r[t].offset=new Vector2(l,h);const i=r[t].trisCount,p=o+i;c.push(...r[t].localVertexArray),u.push(...r[t].textureArray),g.push(...r[t].colorArray),f.push(o),o=p,d.push(i-1)}this.material.SetBuffer(this.geometryBufferID,c),this.material.SetBuffer(this.textureBufferID,u),this.material.SetBuffer(this.colorBufferID,g),this.#d=d,this.#f=f,this.#e=!1}ForceMeshUpdate(){this.#A=this.color;const t=this.pixelPerUnit/this.#l,e=this.#m.texture.width,i=this.#m.texture.height,s=e/t,h=i/t,r=this.#n/s,o=this.#a/h,n=this.font.lineHeight/i;let a=0,l=0,c=n,u=[],g=[{size:0,count:0}],d=0;for(let t=0;t<this.#u.length;t++){const s=this.#u[t];if(s.lineBreak){if(0!==a){const t=g[g.length-1].size;t>d&&(d=t),g.push({size:0,count:0})}l+=c,a=0,c=n;continue}const h=s.width/e,f=!this.#i&&a+h>r;if(0===a&&f&&!s.space){const t=s.sprites;let h=!1;for(let s=0;s<t.length;s++){const f=t[s],p=f.rect.width/e;if(!this.overflowWidth&&a+p>r){const t=g[g.length-1].size;t>d&&(d=t),l+=c,a=0,c=n,g.push({size:0,count:0})}const w=f.rect.height/i;if(c<w&&(c=w),!this.overflowHeight&&l+w>o){h=!0;break}const x=this.#S(f,new Vector2(a,-l));u.push(x),a+=p,g[g.length-1].size+=p,g[g.length-1].count++}if(h)break;continue}if(f){const t=g[g.length-1].size;t>d&&(d=t),l+=c,a=0,c=n,g.push({size:0,count:0})}const p=s.height/i;if(c<p&&(c=p),!this.#s&&l+c>o)break;if(s.space){if(0===a)continue;if(!this.#i){const i=this.#u[t+1];if(null==i||a+h+i.width/e>r){const t=g[g.length-1].size;t>d&&(d=t),l+=c,a=0,c=n,g.push({size:0,count:0});continue}}}const w=this.#C(s.sprites,new Vector2(a,l));u.push(...w),a+=h,g[g.length-1].size+=h,g[g.length-1].count+=s.sprites.length}const f=g[g.length-1].size;f>d&&(d=f),l+=n,this.characters=u,this.#g=g,this.#o=l;const p=new Vector2(d*s,(this.#s?l:Math.min(l,o))*h);this.#p=p,this.#w=Vector2.Scale(new Vector2(p.x-r*s,o*h-p.y),.5),this.#t=!1,this.#V(),super.ForceMeshUpdate()}RemapGraphicArrays(){this.#e=!0}Render(){if(!this.isLoaded||!this.gameObject.activeSelf)return;this.#A!==this.color&&this.ForceMeshUpdate();const t=this.characters;if(0===t.length)return;this.#e&&this.#V();const e=this.material.gl,i=this.renderMatrix;this.material.SetMatrix(this.uMatrixID,i.matrix[0][0],i.matrix[0][1],i.matrix[0][2],i.matrix[1][0],i.matrix[1][1],i.matrix[1][2],i.matrix[2][0],i.matrix[2][1],i.matrix[2][2]),this.material.SetAttribute(this.aVertexPosID,this.geometryBufferID),this.material.SetAttribute(this.aTexturePosID,this.textureBufferID),this.material.SetAttribute(this.aColorID,this.colorBufferID),e.useProgram(this.material.program),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.font.texture.GetNativeTexture()),Application.gl_multidraw.multiDrawArraysWEBGL(e.TRIANGLE_STRIP,this.#f,0,this.#d,0,t.length),e.useProgram(null)}}class TextAnchorX{static get Left(){return 0}static get Center(){return 1}static get Right(){return 2}}class TextAnchorY{static get Top(){return 0}static get Middle(){return 1}static get Bottom(){return 2}}