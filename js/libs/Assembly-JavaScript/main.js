class Loader extends GameBehavior{static#e=!1;static#t=[];static readyScenes=[];static target=null;static onSwitchStart=new DelegateEvent;static onSwitchEnd=new DelegateEvent;static async ReadyLoader(){this.#e||(await SceneManager.Load(1),this.#e=!0)}static async Ready(e){this.#t.includes(e)||this.readyScenes.includes(e)||(this.#t.push(e),await SceneManager.Load(e),this.#t.splice(this.#t.indexOf(e),1),this.readyScenes.push(e))}static async SwitchBase(e){this.readyScenes.splice(this.readyScenes.indexOf(this.target),1),await SceneManager.SetActiveScene(this.target);const frameCall=()=>{PlayerLoop.onAfterMeshUpdate.Remove(frameCall),e&&this.onSwitchStart.Invoke(),this.onSwitchEnd.Invoke()};PlayerLoop.onAfterMeshUpdate.Add(frameCall),this.target=null,this.ReadyLoader()}static async Switch(e){if(this.target=e,!this.readyScenes.includes(e))return await CrystalEngine.Wait((()=>this.#e)),this.#e=!1,void SceneManager.SetActiveScene(1);this.SwitchBase(!0)}#a=0;#s=null;Awake(){this.#s=this.GetComponent("SpriteRenderer"),this.#s.color.a=0,Loader.onSwitchStart.Invoke()}Update(){null!=Loader.target&&Loader.readyScenes.includes(Loader.target)&&Loader.SwitchBase(),this.#a>=.3333&&(this.#s.color.a=Math.min(2*(this.#a-.3333),1)),this.#a+=Time.deltaTime}}class Init extends GameBehavior{Awake(){FPSMeter.detailed=!0,Loader.ReadyLoader(),Loader.Ready(2),Loader.Switch(2)}}class MapInit extends GameBehavior{#e=!1;Awake(){Loader.Ready(6)}Update(){if(this.#e)return;this.#e=!0;const e=new MapTransfer;e.pos=new Vector2(-20,-16),MapTransfer.last=e;const n=Player.instance.GetComponent("SpriteRenderer");Loader.onSwitchStart.Add((()=>n.color.a=0)),Loader.onSwitchEnd.Add((()=>n.color.a=1));const switchCall=()=>{Loader.onSwitchEnd.Remove(switchCall),Transitioner.instance.FadeIn((()=>Player.instance.avoidInputs=!1))};Loader.onSwitchEnd.Add(switchCall),Loader.Switch(6)}}class Viewport extends GameBehavior{#e=0;Update(){if(Input.GetKeyDown(KeyCode.F2)||GamepadInput.GetKeyDown(KeyCode.Select))switch(this.#e++,3===this.#e&&(this.#e=0),this.#e){case 0:FPSMeter.enabled=!1,FPSMeter.msMode=!1;break;case 1:FPSMeter.enabled=!0;break;case 2:FPSMeter.msMode=!0}(Input.GetKeyDown(KeyCode.F4)||GamepadInput.GetKeyDown(KeyCode.Start))&&(Window.fullscreen=!Window.fullscreen)}LateUpdate(){if(4===Options.resolution){const e=window.innerWidth*window.devicePixelRatio,t=window.innerHeight*window.devicePixelRatio,i=Math.max(e<t?e/480:t/432,1);Window.SetResolution(480*i,432*i)}FPSMeter.Update()}}class TitleScreen extends GameBehavior{#e=!1;#t=!1;#i=0;#s=0;#n=1;#a=-1;#o=0;#r=0;#l=()=>{};#c=null;#h=null;#d=null;#b=null;#p=null;Awake(){Crispixels.effect=!0,Cursor.visible=!1}Start(){this.#c=GameObject.Find("choicebox"),this.#c.transform.scale=new Vector2(1,0),this.#h=GameObject.Find("choicebox_content"),this.#d=GameObject.Find("selector"),this.#b=this.#d.GetComponent("SpriteRenderer"),this.#o=this.#d.transform.position.y,this.#h.SetActive(!1),this.#p=GameObject.Find("options").GetComponent("Options"),Loader.Ready(3),Transitioner.instance.FadeIn((()=>{this.#e=!0})),this.Enable()}Enable(){this.#i=.125}#m(e){this.#h.SetActive(!1),this.#s=.125,null!=e&&(this.#l=e)}Update(){if(!this.#e)return;if(this.#i>0&&(this.#i-=Time.deltaTime,this.#c.transform.scale=new Vector2(1,Math.min((.125-this.#i)/.125,1)),this.#i<=0))return this.#t=!0,void this.#h.SetActive(!0);if(this.#s>0)return this.#s-=Time.deltaTime,this.#c.transform.scale=new Vector2(1,Math.max(this.#s/.125,0)),void(this.#s<=0&&(this.#t=!1,this.#l(),this.#l=()=>{}));if(!this.#t)return;this.#n=Math.Clamp(this.#n+1.75*Time.deltaTime*this.#a,.5,1),.5===this.#n?this.#a=1:1===this.#n&&(this.#a=-1),this.#b.color.a=this.#n;let e=!1;if(InputManager.IsRepeated("down")?(this.#r++,2===this.#r&&InputManager.Clear(),this.#r>2&&(this.#r=0),e=!0):InputManager.IsRepeated("up")&&(this.#r--,0===this.#r&&InputManager.Clear(),this.#r<0&&(this.#r=2),e=!0),InputManager.GetKeyDown("z"))switch(AudioManager.instance.PlayConfirm(),this.#r){case 0:this.#m((()=>{AudioManager.instance.StopBGM(),Transitioner.instance.FadeOut((()=>{const clearCall=()=>{Loader.onSwitchStart.Remove(clearCall),Transitioner.instance.Clear()};Loader.onSwitchStart.Add(clearCall),Loader.Switch(3)}))}));break;case 1:this.#m((()=>{}));break;case 2:this.#m((()=>{this.#p.Enable()}))}e&&(this.#d.transform.position=new Vector2(this.#d.transform.position.x,this.#o-this.#b.bounds.size.y*this.#r),AudioManager.instance.PlaySelect())}}class AudioManager extends GameBehavior{static#t=100;static#e=100;static onBGMVolumeChange=new DelegateEvent;static onSEVolumeChange=new DelegateEvent;static instance=null;static get bgmVolume(){return this.#t}static set bgmVolume(t){this.#t=t,this.onBGMVolumeChange.Invoke(t/100)}static get seVolume(){return this.#e}static set seVolume(t){this.#e=t,this.onSEVolumeChange.Invoke(t/100)}#i=null;#o=null;#s=null;#l=null;bgm=null;Awake(){this.DontDestroyOnLoad(this,["audio/se/select","audio/se/confirm","audio/se/no"])}Start(){AudioManager.instance=this;const t=this.GetComponents("AudioSource");this.bgm=t[0],this.bgm.volume=.24,AudioManager.onBGMVolumeChange.Add((t=>this.bgm.volume=.24*t)),this.#o=t[1],this.#o.volume=.4,this.#s=t[2],this.#s.volume=.4,this.#l=t[3],this.#l.volume=.6,AudioManager.onSEVolumeChange.Add((t=>{this.#o.volume=.4*t,this.#s.volume=.4*t,this.#l.volume=.6*t}))}PlayBGM(t){this.#i=`audio/bgm/${t}`,Resources.DontDestroyOnLoad(this.#i),this.bgm.clip=Resources.Find(this.#i),this.bgm.Play()}StopBGM(){this.bgm.Stop(),Resources.DestroyOnLoad(this.#i),this.#i=null}PlaySelect(){Application.isMobilePlatform?this.#o.PlayOneShot(this.#o.clip):(this.#o.Stop(),this.#o.Play())}PlayConfirm(){Application.isMobilePlatform?this.#s.PlayOneShot(this.#s.clip):(this.#s.Stop(),this.#s.Play())}PlayNo(){Application.isMobilePlatform?this.#l.PlayOneShot(this.#l.clip):(this.#l.Stop(),this.#l.Play())}}class Transitioner extends GameBehavior{static instance=null;#t=0;#i=0;#e=0;#n=0;#s=()=>{};#a=()=>{};#h=new Color(0,0,0,0);#o=new Color(0,0,0,0);#r=0;#T=0;#m=[];#l=0;#u=-1;#d=0;#S=-1;#c=()=>{};#p=()=>{};#O=null;Awake(){Transitioner.instance=this,this.#O=this.GetComponent("SpriteRenderer"),this.DontDestroyOnLoad(this,["sprites/pixel"])}FadeIn(t=(()=>{})){this.#t=.4,this.#i=.4,this.#s=t}FadeOut(t=(()=>{})){this.#e=1,this.#n=1,this.#a=t}#I(){return this.#t>0?(this.#t-=Time.deltaTime,this.#O.color.a=Math.max(this.#t/this.#i,0),void(this.#t<=0&&(this.#s(),this.#s=()=>{}))):this.#e>0?(this.#e-=Time.deltaTime,this.#O.color.a=Math.min((this.#n-this.#e)/this.#n,1),void(this.#e<=0&&(this.#a(),this.#a=()=>{}))):void 0}#f(){if(!(this.#T<=0)){this.#T-=Time.deltaTime,this.#h=Color.Lerp(this.#o,this.#h,this.#T/this.#r);for(let t=0;t<this.#m.length;t++)this.#m[t].SetVector("uTint",this.#h.r,this.#h.g,this.#h.b,0)}}#F(t,i){if(0!==i)this.#o=t.Duplicate(),this.#T=i,this.#r=i;else for(let i=0;i<this.#m.length;i++)this.#m[i].SetVector("uTint",t.r,t.g,t.b,0)}TintIn(t=(()=>{})){this.#m=[];const i=GameObject.FindComponents("Renderer");for(let t=0;t<i.length;t++){const e=i[t];if(e===this.#O)continue;const n=new Material(null,Shader.Find("Default/Tinted","FRAGMENT"));if(e.material=n,n.SetVector("uTint",0,0,0,0),this.#m.push(n),e instanceof Tilemap){const t=e.materials;for(let i=0;i<t.length;i++)t[i].SetVector("uTint",0,0,0,0);this.#m.push(...t)}}this.#l=3,this.#u=3,this.#c=t}TintOut(t=(()=>{})){this.#m=[];const i=GameObject.FindComponents("Renderer");for(let t=0;t<i.length;t++){const e=i[t];if(e===this.#O)continue;const n=new Material(null,Shader.Find("Default/Tinted","FRAGMENT"));if(e.material=n,n.SetVector("uTint",130/255,120/255,90/255,0),this.#m.push(n),e instanceof Tilemap){const t=e.materials;for(let i=0;i<t.length;i++)t[i].SetVector("uTint",130/255,120/255,90/255,0);this.#m.push(...t)}}this.#d=3,this.#S=2,this.#p=t}Clear(){this.#t=0,this.#e=0,this.#u=-1,this.#S=-1,this.#O.color.a=0;for(let t=0;t<this.#m.length;t++)this.#m[t].SetVector("uTint",0,0,0,0)}#C(){3===this.#l&&3===this.#u?this.#F(new Color(20/255,10/255,10/255),1/60):3===this.#l&&2===this.#u?this.#F(new Color(90/255,80/255,50/255),1/60):3===this.#l&&1===this.#u&&this.#F(new Color(130/255,120/255,90/255),1/60),this.#u>0&&(this.#l-=60*Time.deltaTime,this.#l<=0&&(this.#u--,this.#u>0?this.#l=3:(this.#c(),this.#c=()=>{}))),3===this.#d&&2===this.#S?this.#F(new Color(90/255,80/255,50/255),1/60):3===this.#d&&1===this.#S&&this.#F(new Color(0,0,0),1/60),this.#S>0&&(this.#d-=60*Time.deltaTime,this.#d<=0&&(this.#S--,this.#S>0?this.#d=3:(this.#p(),this.#p=()=>{})))}Update(){this.#I(),this.#f(),this.#C()}LateUpdate(){null!=CamCtrl.current&&(this.transform.position=CamCtrl.current.transform.position)}}class Options extends GameBehavior{static run=!1;static textSkip=!1;static resolution=1;static windowSize=0;static fps=5;#e=!1;#t=0;#n=0;#i=1;#s=-1;#a=0;#o=0;#r=null;#l=null;#c=null;#p=null;#d=null;#h=null;#u=null;Start(){this.transform.scale=new Vector2(1,0),this.#r=GameObject.Find("camera").GetComponent("TitleScreen"),this.#l=GameObject.Find("options_content"),this.#c=GameObject.Find("options_selector"),this.#p=this.#c.GetComponent("SpriteRenderer"),this.#a=this.#c.transform.position.y,this.#d=GameObject.Find("options_data").GetComponent("Text"),this.#h=GameObject.Find("options_leftarrow"),this.#u=GameObject.Find("options_rightarrow"),this.#l.SetActive(!1),this.#w()}Update(){if(this.#t>0&&(this.#t-=Time.deltaTime,this.transform.scale=new Vector2(1,Math.min((.125-this.#t)/.125,1)),this.#t<=0))return this.#e=!0,void this.#l.SetActive(!0);if(this.#n>0)return this.#n-=Time.deltaTime,this.transform.scale=new Vector2(1,Math.max(this.#n/.125,0)),void(this.#n<=0&&(this.#e=!1,this.#o=0,this.#c.transform.position=new Vector2(this.#c.transform.position.x,this.#a),this.#g(),this.#r.Enable()));if(!this.#e)return;InputManager.GetKeyDown("x")&&this.#I(),this.#i=Math.Clamp(this.#i+1.75*Time.deltaTime*this.#s,.5,1),.5===this.#i?this.#s=1:1===this.#i&&(this.#s=-1),this.#p.color.a=this.#i;let e=!1;switch(InputManager.IsRepeated("down")&&(this.#o++,8===this.#o&&InputManager.Clear(),this.#o>8&&(this.#o=0),e=!0),InputManager.IsRepeated("up")&&(this.#o--,0===this.#o&&InputManager.Clear(),this.#o<0&&(this.#o=8),e=!0),this.#o){case 0:this.#S();break;case 1:this.#f();break;case 2:this.#m();break;case 3:this.#M();break;case 4:this.#x();break;case 5:this.#O();break;case 6:this.#b();break;case 7:this.#A();break;case 8:this.#y()}if(e){let e=this.#o;this.#o>=2&&(e+=2),this.#o>=7&&(e+=2),this.#c.transform.position=new Vector2(this.#c.transform.position.x,this.#a-this.#p.bounds.size.y*e),AudioManager.instance.PlaySelect(),this.#g()}}Enable(){this.#t=.125}#I(){this.#l.SetActive(!1),this.#n=.125,AudioManager.instance.PlayNo()}#g(){let e=new Vector2(1.38,2.61);if(0===this.#o)e=new Vector2(Options.run?1.32:1.2,Options.run?2.68:2.8);else if(1===this.#o&&Options.textSkip||2===this.#o&&Window.fullscreen||6===this.#o&&Crispixels.effect)e=new Vector2(1.5,2.52);else if(3===this.#o)switch(Options.resolution){case 2:case 3:e=new Vector2(.2,3.8);break;case 4:e=new Vector2(0,4);break;default:e=new Vector2(.5,3.5)}else if(4===this.#o)switch(Options.windowSize){case 2:case 3:e=new Vector2(.2,3.8);break;case 4:e=new Vector2(.6,3.4);break;default:e=new Vector2(.5,3.5)}else if(5===this.#o){switch(Options.fps){case 3:e=new Vector2(1.3,2.7);break;case 4:e=new Vector2(.6,3.4);break;case 5:e=new Vector2(.5,5.1);break;default:e=new Vector2(1.5,2.5)}0===Options.fps&&(e.x=5.1)}else 7===this.#o&&0===AudioManager.bgmVolume||8===this.#o&&0===AudioManager.seVolume?e=new Vector2(5.1,2.34):7===this.#o&&100===AudioManager.bgmVolume||8===this.#o&&100===AudioManager.seVolume?e.y=5.1:7!==this.#o&&8!==this.#o||(e=new Vector2(1.5,2.52));this.#h.transform.localPosition=new Vector2(e.x,0),this.#u.transform.localPosition=new Vector2(e.y,0)}#w(){const toggle=e=>e?"On":"Off",e=Options.resolution+1,t=e>4?"Match "+(Window.fullscreen?"Screen":"Window"):`${480*e} x ${432*e}`,n=Options.windowSize+1,i=n>4?"Whatever":`${480*n} x ${432*n}`;let s=Application.vSyncCount>0?"V-Synced":Application.targetFrameRate;s<0&&(s="Unlimited"),this.#d.text=`${Options.run?"Run":"Walk"}\n${toggle(Options.textSkip)}\n\n\n${toggle(Window.fullscreen)}\n${t}\n${i}\n${s}\n${toggle(Crispixels.effect)}\n\n\n${AudioManager.bgmVolume}\n${AudioManager.seVolume}`,this.#g()}#S(){(InputManager.GetKeyDown("left")||InputManager.GetKeyDown("right")||InputManager.GetKeyDown("z"))&&(Options.run=!Options.run,this.#w(),AudioManager.instance.PlaySelect())}#f(){(InputManager.GetKeyDown("left")||InputManager.GetKeyDown("right")||InputManager.GetKeyDown("z"))&&(Options.textSkip=!Options.textSkip,this.#w(),AudioManager.instance.PlaySelect())}#m(){(InputManager.GetKeyDown("left")||InputManager.GetKeyDown("right")||InputManager.GetKeyDown("z"))&&(Window.fullscreen=!Window.fullscreen,this.#w(),AudioManager.instance.PlaySelect())}#M(){let e=!1;if((InputManager.IsRepeated("right")||InputManager.IsRepeated("z"))&&(Options.resolution++,Options.resolution>4&&(Options.resolution=1),e=!0),InputManager.IsRepeated("left")&&(Options.resolution--,Options.resolution<1&&(Options.resolution=4),e=!0),e){if(Options.resolution<4){const e=Options.resolution+1;Window.SetResolution(480*e,432*e)}this.#w(),AudioManager.instance.PlaySelect()}}#x(){let e=!1;if((InputManager.IsRepeated("right")||InputManager.IsRepeated("z"))&&(Options.windowSize++,Options.windowSize>4&&(Options.windowSize=0),e=!0),InputManager.IsRepeated("left")&&(Options.windowSize--,Options.windowSize<0&&(Options.windowSize=4),e=!0),!e)return;let t=Options.windowSize+1;5!==t&&(480*t>window.screen.width||432*t>window.screen.height)&&(InputManager.IsRepeated("left")?(Options.windowSize=0,t=1):(Options.windowSize=4,t=5)),t<5?(Window.resizable=!1,Window.SetWindowSize(480*t,432*t)):Window.resizable=!0,this.#w(),AudioManager.instance.PlaySelect()}#O(){let e=!1;if(Options.fps<5&&(InputManager.IsRepeated("right")||InputManager.IsRepeated("z"))&&(Options.fps++,e=!0),Options.fps>0&&InputManager.IsRepeated("left")&&(Options.fps--,e=!0),!e)return;const t=[30,60,90,120,-1];Options.fps>4?Application.vSyncCount=1:(Application.vSyncCount=0,Application.targetFrameRate=t[Options.fps]),this.#w(),AudioManager.instance.PlaySelect()}#b(){(InputManager.GetKeyDown("left")||InputManager.GetKeyDown("right")||InputManager.GetKeyDown("z"))&&(Crispixels.effect=!Crispixels.effect,this.#w(),AudioManager.instance.PlaySelect())}#A(){const e=+(InputManager.IsRepeated("right")||InputManager.IsRepeated("z"))-+InputManager.IsRepeated("left");0===e||e<0&&0===AudioManager.bgmVolume||e>0&&100===AudioManager.bgmVolume||(AudioManager.bgmVolume=Math.Clamp(AudioManager.bgmVolume+20*e,0,100),this.#w(),AudioManager.instance.PlaySelect())}#y(){const e=+(InputManager.IsRepeated("right")||InputManager.IsRepeated("z"))-+InputManager.IsRepeated("left");0===e||e<0&&0===AudioManager.seVolume||e>0&&100===AudioManager.seVolume||(AudioManager.seVolume=Math.Clamp(AudioManager.seVolume+20*e,0,100),this.#w(),AudioManager.instance.PlaySelect())}}class InputManager extends GameBehavior{static instance=null;#t=!0;#e=!1;#s=0;#i=.4;#n=.1;#r=0;#h=[];#a=[];#p=null;#d=null;#o=null;#u=null;#l=null;#c=null;#g=null;#y=null;#I=null;#B=class{#m=[];#f=[];#K=[];#x=[];name=null;get pressed(){for(let t=0;t<this.#m.length;t++)if(Input.GetKey(this.#m[t]))return!0;for(let t=0;t<this.#f.length;t++)if(GamepadInput.GetKey(this.#f[t]))return!0;for(let t=0;t<this.#K.length;t++)if(this.#K[t].state)return!0;for(let t=0;t<this.#x.length;t++)if(this.#x[t].pressed)return!0;return!1}get pressedDown(){for(let t=0;t<this.#m.length;t++)if(Input.GetKeyDown(this.#m[t]))return!0;for(let t=0;t<this.#f.length;t++)if(GamepadInput.GetKeyDown(this.#f[t]))return!0;for(let t=0;t<this.#K.length;t++)if(this.#K[t].state&&!this.#K[t].lastState)return!0;for(let t=0;t<this.#x.length;t++)if(this.#x[t].pressedDown)return!0;return!1}get pressedUp(){for(let t=0;t<this.#m.length;t++)if(Input.GetKeyUp(this.#m[t]))return!0;for(let t=0;t<this.#f.length;t++)if(GamepadInput.GetKeyUp(this.#f[t]))return!0;for(let t=0;t<this.#K.length;t++)if(!this.#K[t].state&&this.#K[t].lastState)return!0;for(let t=0;t<this.#x.length;t++)if(this.#x[t].pressedUp)return!0;return!1}constructor(t){this.name=t}KeyboardInput(t){this.#m.push(t)}GamepadInput(t){this.#f.push(t)}GamepadAxis(t,e,s){this.#K.push({name:t,dir:e,pull:s,state:!1,lastState:!1})}TouchInput(t){this.#x.push(t)}Update(){for(let t=0;t<this.#K.length;t++){const e=this.#K[t];e.dir>0?e.state=GamepadInput.GetAxis(e.name)>=e.pull:e.state=GamepadInput.GetAxis(e.name)<=-e.pull}}UpdateEnd(){for(let t=0;t<this.#K.length;t++)this.#K[t].lastState=this.#K[t].state}};static FindKey(t){return this.instance.FindKey(t)}static GetKey(t){return this.instance.GetKey(t)}static GetKeyDown(t){return this.instance.GetKeyDown(t)}static GetKeyUp(t){return this.instance.GetKeyUp(t)}static IsPressed(t){return this.instance.IsPressed(t)}static IsTriggered(t){return this.instance.IsTriggered(t)}static IsLongPressed(t){return this.instance.IsLongPressed(t)}static IsRepeated(t){return this.instance.IsRepeated(t)}static Clear(){this.instance.Clear()}#w(t){this.#t!==t&&(this.#p.SetActive(t),this.#d.SetActive(t),this.#o.SetActive(t),this.#u.SetActive(t),this.#l.SetActive(t),this.#c.SetActive(t),this.#g.SetActive(t),this.#y.SetActive(t),this.#t=t)}Awake(){this.DontDestroyOnLoad(this,["ctrls/bounds","ctrls/dpad","ctrls/dpad/up","ctrls/dpad/down","ctrls/dpad/left","ctrls/dpad/right","ctrls/z","ctrls/z1","ctrls/x","ctrls/x1","ctrls/shift","ctrls/shift1"])}Start(){this.#a=[Resources.Find("ctrls/dpad"),Resources.Find("ctrls/dpad/up"),Resources.Find("ctrls/dpad/down"),Resources.Find("ctrls/dpad/left"),Resources.Find("ctrls/dpad/right"),Resources.Find("ctrls/z"),Resources.Find("ctrls/z1"),Resources.Find("ctrls/x"),Resources.Find("ctrls/x1"),Resources.Find("ctrls/shift"),Resources.Find("ctrls/shift1")],InputManager.instance=this,HTMLUI.referenceResolution=new Vector2(480,432),HTMLUI.scaleMode=HUIScaleMode.Screen,HTMLUI.matchMode=HUIMatchMode.Shrink,this.#p=new HTMLUI.Image(this.#a[0]),this.#p.position=new Vector2(2.25,2),this.#p.horizontalOrigin=HUIOriginX.Left,this.#p.verticalOrigin=HUIOriginY.Bottom;const t=Resources.Find("ctrls/bounds");this.#d=new HTMLUI.Button(t),this.#d.position=new Vector2(2.25,2.8333),this.#d.horizontalOrigin=HUIOriginX.Left,this.#d.verticalOrigin=HUIOriginY.Bottom,this.#d.registerSlide=!0,this.#d.opacity=0,this.#o=new HTMLUI.Button(t),this.#o.position=new Vector2(2.25,1.1667),this.#o.rotation=180,this.#o.horizontalOrigin=HUIOriginX.Left,this.#o.verticalOrigin=HUIOriginY.Bottom,this.#o.registerSlide=!0,this.#o.opacity=0,this.#u=new HTMLUI.Button(t),this.#u.position=new Vector2(1.4167,2),this.#u.rotation=90,this.#u.horizontalOrigin=HUIOriginX.Left,this.#u.verticalOrigin=HUIOriginY.Bottom,this.#u.registerSlide=!0,this.#u.opacity=0,this.#l=new HTMLUI.Button(t),this.#l.position=new Vector2(3.0833,2),this.#l.rotation=270,this.#l.horizontalOrigin=HUIOriginX.Left,this.#l.verticalOrigin=HUIOriginY.Bottom,this.#l.registerSlide=!0,this.#l.opacity=0,this.#c=new HTMLUI.Button(this.#a[5]),this.#c.position=new Vector2(-2.5,1),this.#c.horizontalOrigin=HUIOriginX.Right,this.#c.verticalOrigin=HUIOriginY.Bottom,this.#g=new HTMLUI.Button(this.#a[7]),this.#g.position=new Vector2(-1.5,2),this.#g.horizontalOrigin=HUIOriginX.Right,this.#g.verticalOrigin=HUIOriginY.Bottom,this.#y=new HTMLUI.Button(this.#a[9]),this.#y.position=new Vector2(-3.5,2),this.#y.horizontalOrigin=HUIOriginX.Right,this.#y.verticalOrigin=HUIOriginY.Bottom,Application.isMobilePlatform||this.#w(!1),this.#h=[new this.#B("up"),new this.#B("down"),new this.#B("left"),new this.#B("right"),new this.#B("z"),new this.#B("x"),new this.#B("shift")],this.#h[0].KeyboardInput(KeyCode.ArrowUp),this.#h[0].GamepadInput(KeyCode.DpadUp),this.#h[0].GamepadAxis("left stick vertical",1,.5),this.#h[0].TouchInput(this.#d),this.#h[1].KeyboardInput(KeyCode.ArrowDown),this.#h[1].GamepadInput(KeyCode.DpadDown),this.#h[1].GamepadAxis("left stick vertical",-1,.5),this.#h[1].TouchInput(this.#o),this.#h[2].KeyboardInput(KeyCode.ArrowLeft),this.#h[2].GamepadInput(KeyCode.DpadLeft),this.#h[2].GamepadAxis("left stick horizontal",-1,.5),this.#h[2].TouchInput(this.#u),this.#h[3].KeyboardInput(KeyCode.ArrowRight),this.#h[3].GamepadInput(KeyCode.DpadRight),this.#h[3].GamepadAxis("left stick horizontal",1,.5),this.#h[3].TouchInput(this.#l),this.#h[4].KeyboardInput(KeyCode.Z),this.#h[4].GamepadInput(KeyCode.SouthButton),this.#h[4].TouchInput(this.#c),this.#h[5].KeyboardInput(KeyCode.X),this.#h[5].GamepadInput(KeyCode.EastButton),this.#h[5].TouchInput(this.#g),this.#h[6].KeyboardInput(KeyCode.Shift),this.#h[6].GamepadInput(KeyCode.WestButton),this.#h[6].TouchInput(this.#y)}EarlyUpdate(){HTMLUI.Update();let t=!1;for(let e=0;e<this.#h.length;e++){const s=this.#h[e];s.Update(),s.pressedDown&&(this.#I=s.name,this.#s=0,this.#r=0),this.#I===s.name&&s.pressed&&(t=!0)}t||(this.#I=null),null!=this.#I&&(this.#e=!1,this.#s>=this.#r&&(this.#e=!0,this.#r=this.#s+this.#n),this.#s+=Time.deltaTime)}Update(){this.#t?((Input.anyKeyDown||GamepadInput.anyKey)&&this.#w(!1),this.#d.pressed?this.#p.texture=this.#a[1]:this.#o.pressed?this.#p.texture=this.#a[2]:this.#u.pressed?this.#p.texture=this.#a[3]:this.#l.pressed?this.#p.texture=this.#a[4]:this.#p.texture=this.#a[0],this.#c.texture=this.#a[+this.#c.pressed+5],this.#g.texture=this.#a[+this.#g.pressed+7],this.#y.texture=this.#a[+this.#y.pressed+9]):Input.touchCount>0&&this.#w(!0)}LateUpdate(){HTMLUI.UpdateEnd();for(let t=0;t<this.#h.length;t++)this.#h[t].UpdateEnd()}OnDisable(){HTMLUI.Clear()}FindKey(t){return this.#h.find((e=>e.name===t))}GetKey(t){return this.FindKey(t).pressed}GetKeyDown(t){return this.FindKey(t).pressedDown}GetKeyUp(t){return this.FindKey(t).pressedUp}IsPressed(t){return this.GetKey(t)}IsTriggered(t){return this.GetKeyDown(t)}IsLongPressed(t){return this.#I===t&&this.#s>=this.#i}IsRepeated(t){return this.IsTriggered(t)||this.IsLongPressed(t)&&this.#e}Clear(){this.#I=null}}class RPGMovement extends GameBehavior{#t=!0;#e=!1;#o=!1;#i=0;#s=0;#r=0;#n=0;#h=Vector2.zero;#a=Vector2.down;#l=Vector2.zero;#c=Vector2.zero;#d=null;#m=null;_moveDir=Vector2.zero;_sprResolver=null;get _shouldMove(){return this.updateMovement}get lookingAt(){return this.#a}set lookingAt(t){this.LookAt(t)}updateMovement=!0;speed=1.875;speedScale=1;tileSize=new Vector2(.5,.5);onMoveStart=new DelegateEvent;onStop=new DelegateEvent;#v(){this._moveDir=this.#h,this.#l=Vector2.Scale(this._moveDir,this.tileSize)}#p(){const t=MapGrid.current.NodeOn(Vector2.Add(this.#m.pos,this._moveDir));if(this._DirCheck(t))return!0;this.#d=this.#m,this.#m=t,this.#m.owner=this}#S(){if(!this.#e&&(this.#e=!0,this.#p()))return this.lookingAt=this._moveDir,this._moveDir=Vector2.zero,void(this.transform.position=this.#c);this.#o||(this.#o=!0,this.onMoveStart.Invoke());const t=Vector2.Add(this.transform.position,Vector2.Scale(this._moveDir,Time.deltaTime*this.#s));if(Vector2.Abs(Vector2.Subtract(t,this.#c)).Greater(Vector2.Abs(this.#l)))return this.#d.owner=null,this.#d=null,Window.SetTitle(`${this.#m.gridPos.toString()} ${this.transform.localPosition.x} ${this.transform.localPosition.y}`),this.#h=Vector2.zero,this._moveDir=Vector2.zero,this.transform.position=Vector2.Add(this.#c,this.#l),this.#o=!1,this.#t=!0,this._OnStop(),void this.onStop.Invoke();this.lookingAt=this._moveDir,this.transform.position=t,this._OnMove()}Start(){this._sprResolver=this.GetComponent("SpriteResolver")}OnEnable(){this.#m=MapGrid.current.NodeOnWorld(this.transform.position),this.#m.owner=this,this.transform.localPosition=Vector2.Add(this.transform.localPosition,new Vector2(0,.3125))}Update(){this._moveDir.Equals(Vector2.zero)&&(this._OnMovementGet(),this.#v(),this.#i=this.speedScale,this.#s=this.speed*this.#i,this.#c=this.transform.position,this.#e=!1),this._moveDir.Equals(Vector2.zero)?(this.#t=!0,this._OnStay()):this._shouldMove&&this.#S(),this.#D()}#D(){this.#o?this.#r+=1.5*Time.deltaTime:1===this.#n&&(this.#r+=Time.deltaTime),this.#r>=(2===this.#i?.2:.25)&&(this.#n=+(0===this.#n),this._sprResolver.label=`${this.#n}`,this.#r=0)}_DirCheck(t){return t.collider}_OnMovementGet(){}_OnMove(){}_OnStop(){}_OnStay(){}MoveTowards(t){this.#t&&(this.#t=!0,this.#h=Vector2.Clamp(t,Vector2.Scale(Vector2.one,-1),Vector2.one))}LookAt(t){this.#a.Equals(t)||(this.#a=t,t.y>0?this._sprResolver.category="up":t.y<0?this._sprResolver.category="down":t.x<0?this._sprResolver.category="left":t.x>0&&(this._sprResolver.category="right"))}TP(t){this.#m=MapGrid.current.NodeOnGrid(t),this.#m.owner=this,this.transform.position=MapGrid.current.CellToWorld(t),this.transform.localPosition=Vector2.Add(this.transform.localPosition,new Vector2(0,.3125))}}class Player extends RPGMovement{static instance=null;#t=!1;#e=0;#n=0;#i=null;avoidInputs=!0;Start(){super.Start(),Player.instance=this,this.DontDestroyOnLoad(this,["sprites/chars/yoki","spritelibs/chars/yoki"])}Update(){this.#s(),super.Update()}_DirCheck(t){return!!t.collider||(t.owner instanceof MapTransfer&&(this.avoidInputs=!0,this.#i=t.owner),!1)}_OnMovementGet(){if(this.avoidInputs)return;const t=new Vector2(+InputManager.GetKey("right")-+InputManager.GetKey("left"),+InputManager.GetKey("up")-+InputManager.GetKey("down"));0!==t.x?this.#e++:0!==this.#e&&(this.#e=0),0!==t.y?this.#n++:0!==this.#n&&(this.#n=0),Vector2.Abs(t).Equals(Vector2.one)&&(this.#e>this.#n?t.x=0:t.y=0),this.MoveTowards(t),this.speedScale=(Options.run?!this.#t:this.#t)?2:1}_OnStop(){null!=this.#i&&(MapTransfer.last=this.#i,this.#i=null,Transitioner.instance.TintIn((()=>{const transCall=()=>{Loader.onSwitchEnd.Remove(transCall),Transitioner.instance.TintOut((()=>this.avoidInputs=!1))};Loader.onSwitchEnd.Add(transCall),Loader.Switch(MapTransfer.last.scene)})))}#s(){this.#t=InputManager.GetKey("shift")}}class CamCtrl extends Viewport{static current=null;clampMin=Vector2.zero;clampMax=Vector2.zero;target=null;Awake(){CamCtrl.current=this}LateUpdate(){const t=this.target.position;this.transform.position=Vector2.Clamp(t,this.clampMin,this.clampMax),super.LateUpdate()}}class MapNode{collider=!1;x=0;y=0;gridX=0;gridY=0;owner=null;get pos(){return new Vector2(this.x,this.y)}get gridPos(){return new Vector2(this.gridX,this.gridY)}constructor(r=!1){this.collider=r}}class MapGrid extends GameBehavior{static current=null;#e=null;min=Vector2.zero;max=Vector2.zero;nodes=[];Awake(){MapGrid.current=this,this.#e=this.GetComponent("Grid"),this.#r()}#r(){const e=Vector2.Subtract(this.max,this.min);for(let r=0;r<=e.x;r++){let t=[];for(let i=0;i<=e.y;i++){const e=new MapNode;e.x=r,e.y=i,e.gridX=this.min.x+r,e.gridY=this.min.y+i,t.push(e)}this.nodes.push(t)}}NodeOnGrid(e){return this.nodes.flat().find((r=>r.gridX===e.x&&r.gridY===e.y))}NodeOnWorld(e){return this.NodeOnGrid(this.#e.WorldToCell(e))}CellToWorld(e){return this.#e.CellToWorld(e)}NodeOn(e){const r=this.nodes[e.x];return null==r?new MapNode(!0):r[e.y]??new MapNode(!0)}}class TilemapCollider extends GameBehavior{removeTilemap=!0;Start(){const e=this.GetComponent("Tilemap"),r=Vector2.Subtract(MapGrid.current.max,MapGrid.current.min);for(let t=0;t<=r.x;t++)for(let o=0;o<=r.y;o++){const r=MapGrid.current.NodeOn(new Vector2(t,o));null!=e.GetTile(r.gridPos)&&(r.collider=!0)}this.removeTilemap&&(e.color.a=0,e.gameObject.SetActive(!1))}}class MapConfig extends GameBehavior{transfers=[];Start(){for(let r=0;r<this.transfers.length;r++){Loader.Ready(this.transfers[r].scene);const s=this.transfers[r].min,e=this.transfers[r].max;for(let t=s.x;t<=e.x;t++)for(let a=s.y;a<=e.y;a++)MapGrid.current.NodeOnGrid(new Vector2(t,a)).owner=this.transfers[r]}null!=MapTransfer.last&&Player.instance.TP(MapTransfer.last.pos)}}class MapTransfer{static last=null;scene=0;min=Vector2.zero;max=Vector2.zero;pos=Vector2.zero}class Test extends GameBehavior{#e=null;Start(){this.#e=GameObject.Find("obj").GetComponent("Animator")}Update(){this.#e.SetBool("turn",Input.GetKey(KeyCode.Z))}}class JumpTest extends GameBehavior{#t=.1;#s=0;#i=1;#h=()=>{};#o=null;Start(){this.#o=this.transform.position.Duplicate()}Update(){this.#t>=.1||(this.#t+=Time.deltaTime*this.#i,this.transform.position=new Vector2(this.#o.x,this.#t<=.05?Math.Lerp(this.transform.position.y,this.#o.y+this.#s,this.#t/.075):Math.Lerp(this.transform.position.y,this.#o.y,(this.#t-.05)/.05)),this.#t>=.1&&this.#h())}Jump(t,s,i=(()=>{})){this.#t=0,this.#s=t??.75,this.#i=s??1,this.#h=i}}